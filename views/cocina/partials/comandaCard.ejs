<!-- views/cocina/partials/comandaCard.ejs -->

<div class="col-md-6 col-lg-4 mb-4 comanda-card" id="pedido-<%= pedido.id %>">
    <div class="card h-100 shadow-sm 
        <%= pedido.estado === 'recibido' ? 'border-danger' : 
           pedido.estado === 'en_preparacion' ? 'border-warning' : 
           pedido.estado === 'elaborado' ? 'border-success' : '' %>">

        <div class="card-header d-flex justify-content-between align-items-center
            <%= pedido.estado === 'recibido' ? 'bg-danger text-white' : '' %>">
            <h5 class="mb-0 fw-bold">Mesa <%= pedido.mesa.numero %></h5>
            <span class="badge bg-dark">#<%= pedido.id %></span>
        </div>

        <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">
                <i class="far fa-clock"></i> <%= new Date(pedido.createdAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %>
            </h6>
            <hr>

            <ul class="list-group list-group-flush bg-transparent">
                <% pedido.items.forEach(item => { %>
                    <li class="list-group-item bg-transparent border-0 p-1">
                        <strong>Cliente <%= item.cliente_numero %>:</strong>
                        <% if (item.componentes && item.componentes.length > 0) { %>
                            <%= item.componentes.map(c => c.nombre).join(', ') %>
                        <% } else { %>
                            (Sin componentes definidos)
                        <% } %>

                        <% if (item.notas) { %>
                            <br><small class="fst-italic text-danger">Nota: <%= item.notas %></small>
                        <% } %>
                    </li>
                <% }); %>
            </ul>
        </div>

        <div class="card-footer bg-light text-center pb-3">
            <% if (pedido.estado === 'recibido' || pedido.estado === 'en_preparacion') { %>
                <form action="/cocina/pedido/<%= pedido.id %>/estado" method="POST">
                    <input type="hidden" name="nuevoEstado" value="elaborado">
                    <button type="submit" class="btn btn-warning w-100 fw-bold text-dark shadow-sm">
                        <i class="fas fa-check-circle me-2"></i> Marcar como Listo
                    </button>
                </form>
            <% } else if (pedido.estado === 'elaborado') { %>
                <button class="btn btn-success w-100 disabled">
                    <i class="fas fa-bell me-2"></i> Esperando al Mesero...
                </button>
            <% } %>
        </div>
    </div>
</div>