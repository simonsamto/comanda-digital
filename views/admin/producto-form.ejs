<%- include('../partials/header') %>

<div class="container mt-4">
    <h1><%= typeof producto !== 'undefined' && producto.id ? 'Editar Producto' : 'Añadir Nuevo Producto' %></h1>
    
    <!-- Asegurémonos de que los mensajes de error se muestren correctamente -->
    <%- include('../partials/messages') %>
    <% if (typeof errores !== 'undefined' && errores.length > 0) { %>
        <div class="alert alert-danger">
            <ul>
                <% errores.forEach(error => { %>
                    <li><%= error.msg %></li>
                <% }) %>
            </ul>
        </div>
    <% } %>
    
    <form action="<%= typeof producto !== 'undefined' && producto.id ? '/admin/menu/productos/editar/' + producto.id : '/admin/menu/productos/nuevo' %>" method="POST">
        
        <div class="mb-3">
            <label for="nombre" class="form-label">Nombre del Producto</label>
            <input type="text" class="form-control" id="nombre" name="nombre" value="<%= typeof producto !== 'undefined' ? producto.nombre : '' %>" required>
        </div>
        
        <div class="mb-3">
            <label for="descripcion" class="form-label">Descripción</label>
            <textarea class="form-control" id="descripcion" name="descripcion" rows="3"><%= typeof producto !== 'undefined' ? producto.descripcion : '' %></textarea>
        </div>
        
        <div class="mb-3">
            <label for="precio" class="form-label">Precio</label>
            <input type="number" step="0.01" class="form-control" id="precio" name="precio" value="<%= typeof producto !== 'undefined' ? producto.precio : '' %>" required>
        </div>
        
        <!-- === PUNTO CRÍTICO A VERIFICAR === -->
        <div class="mb-3">
            <label for="CategoriaId" class="form-label">Categoría</label>
            <!-- El atributo 'name' DEBE ser exactamente "CategoriaId" -->
            <select class="form-select" id="CategoriaId" name="CategoriaId" required>
                <option value="">Seleccione una categoría...</option>
                <% if (typeof categorias !== 'undefined') { %>
                    <% categorias.forEach(categoria => { %>
                        <option value="<%= categoria.id %>" <%= (typeof producto !== 'undefined' && producto.CategoriaId == categoria.id) ? 'selected' : '' %>>
                            <%= categoria.nombre %>
                        </option>
                    <% }) %>
                <% } %>
            </select>
        </div>
        <!-- === FIN DEL PUNTO CRÍTICO === -->

        <button type="submit" class="btn btn-primary">Guardar Producto</button>
        <a href="/admin/menu" class="btn btn-secondary">Cancelar</a>
    </form>
</div>

<%- include('../partials/footer') %>