<%- include('../partials/header') %>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="container-fluid mt-4">
    <h1 class="mb-4 text-center fw-bold text-secondary">Tablero de Control Gerencial</h1>

    <!-- 1. KPIs SUPERIORES -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white text-center p-3 shadow-sm">
                <h3>$<%= kpis.ventasHoy.toLocaleString() %></h3>
                <small>Ventas Hoy</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white text-center p-3 shadow-sm">
                <h3><%= kpis.pedidosHoy %></h3>
                <small>Pedidos Pagados</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white text-center p-3 shadow-sm">
                <h3>$<%= kpis.ticketPromedio.toLocaleString(undefined, {maximumFractionDigits:0}) %></h3>
                <small>Ticket Promedio</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-secondary text-white text-center p-3 shadow-sm">
                <!-- Espacio para otro KPI futuro -->
                <h3>--</h3>
                <small>Meta del Día</small>
            </div>
        </div>
    </div>

    <!-- FILA 1: LOS 3 GRANDES -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card shadow h-100">
                <div class="card-header fw-bold">1. Ventas por Hora (Picos de Demanda)</div>
                <div class="card-body"><canvas id="chartHora"></canvas></div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow h-100">
                <div class="card-header fw-bold">2. Estado Actual (En Vivo)</div>
                <div class="card-body"><canvas id="chartEstados"></canvas></div>
            </div>
        </div>
    </div>

    <!-- FILA 2: PRODUCTOS -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card shadow h-100">
                <div class="card-header fw-bold">3. Top 5 Platos</div>
                <div class="card-body"><canvas id="chartPlatos"></canvas></div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow h-100">
                <div class="card-header fw-bold">4. Top 5 Bebidas</div>
                <div class="card-body"><canvas id="chartBebidas"></canvas></div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow h-100">
                <div class="card-header fw-bold">5. Hoy vs. Ayer</div>
                <div class="card-body"><canvas id="chartComparativo"></canvas></div>
            </div>
        </div>
    </div>

    <!-- FILA 3: MESAS Y RENDIMIENTO -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card shadow h-100">
                <div class="card-header fw-bold">6. Mesas Más Rentables ($)</div>
                <div class="card-body"><canvas id="chartMesas"></canvas></div>
            </div>
        </div>
        <!-- Aquí puedes añadir el gráfico 7, 8, 9... -->
        <div class="col-md-6">
            <div class="card shadow h-100">
                <div class="card-header fw-bold">7. Distribución de Métodos de Pago (Ejemplo)</div>
                <div class="card-body d-flex align-items-center justify-content-center text-muted">
                    (Requiere módulo de pagos detallado)
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    // --- 1. VENTAS POR HORA ---
    new Chart(document.getElementById('chartHora'), {
        type: 'line',
        data: {
            labels: Array.from({length: 24}, (_, i) => `${i}:00`),
            datasets: [{
                label: 'Ventas ($)',
                data: <%- graficos.ventasHora %>,
                borderColor: '#4e73df',
                fill: true,
                backgroundColor: 'rgba(78, 115, 223, 0.1)'
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    // --- 2. ESTADOS ---
    new Chart(document.getElementById('chartEstados'), {
        type: 'doughnut',
        data: {
            labels: <%- graficos.estados.labels %>,
            datasets: [{
                data: <%- graficos.estados.data %>,
                backgroundColor: ['#dc3545', '#0dcaf0', '#ffc107', '#198754']
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    // --- 3. TOP PLATOS ---
    new Chart(document.getElementById('chartPlatos'), {
        type: 'bar',
        data: {
            labels: <%- graficos.topPlatos.labels %>,
            datasets: [{
                label: 'Cantidad',
                data: <%- graficos.topPlatos.data %>,
                backgroundColor: '#36b9cc'
            }]
        },
        options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false }
    });

    // --- 4. TOP BEBIDAS ---
    new Chart(document.getElementById('chartBebidas'), {
        type: 'bar',
        data: {
            labels: <%- graficos.topBebidas.labels %>,
            datasets: [{
                label: 'Cantidad',
                data: <%- graficos.topBebidas.data %>,
                backgroundColor: '#e74a3b'
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    // --- 5. COMPARATIVO ---
    new Chart(document.getElementById('chartComparativo'), {
        type: 'bar',
        data: {
            labels: ['Ayer', 'Hoy'],
            datasets: [{
                label: 'Total Ventas',
                data: <%- graficos.comparativo %>,
                backgroundColor: ['#858796', '#1cc88a']
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    // --- 6. MESAS RENTABLES ---
    new Chart(document.getElementById('chartMesas'), {
        type: 'bar',
        data: {
            labels: <%- graficos.topMesas.labels %>,
            datasets: [{
                label: 'Ingresos Generados',
                data: <%- graficos.topMesas.data %>,
                backgroundColor: '#f6c23e'
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });
</script>

<%- include('../partials/footer') %>